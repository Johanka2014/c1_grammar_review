<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C1 English Grammar Course</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use Inter font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Apply Inter font */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Hide screens by default */
        .screen {
            display: none;
        }
        /* Utility class to show the active screen */
        .screen.active {
            display: block;
        }
        /* Custom styles for answer buttons */
        .answer-btn {
            @apply w-full text-center p-4 my-2 bg-sky-500 text-white font-medium rounded-lg shadow-md transition-all duration-150 ease-in-out;
            @apply hover:bg-sky-600 hover:shadow-lg;
        }
        .answer-btn.correct {
            @apply bg-green-500 text-white font-medium;
        }
        .answer-btn.wrong {
            @apply bg-red-500 text-white font-medium;
        }
        .answer-btn:disabled {
            @apply opacity-70 cursor-not-allowed;
        }
    </style>
</head>
<body class="bg-sky-50 text-gray-800">

    <!-- Main Application Container -->
    <div id="app" class="max-w-3xl mx-auto p-4 md:p-8 min-h-screen">
        
        <!-- Home Screen -->
        <div id="home-screen" class="screen active">
            <header class="text-center mb-8">
                <!-- Simple illustration -->
                <div class="w-24 h-24 bg-sky-500 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.253v11.494m0 0a8.485 8.485 0 0011.02-6.246 8.485 8.485 0 00-11.02-6.246m0 12.492a8.485 8.485 0 01-11.02-6.246 8.485 8.485 0 0111.02-6.246" />
                    </svg>
                </div>
                <h1 class="text-4xl font-bold text-sky-800">C1 Grammar Practice</h1>
                <p class="text-lg text-gray-600 mt-2">Choose an advanced C1 structure to practice.</p>
            </header>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Dynamically generated quiz buttons will go here -->
            </div>
        </div>

        <!-- Quiz Screen -->
        <div id="quiz-screen" class="screen">
            <header class="mb-6">
                <h2 id="quiz-title" class="text-3xl font-bold text-sky-800">Quiz Title</h2>
                <div class="flex justify-between items-center mt-2 text-gray-600">
                    <span id="progress-text">Question 1 / 10</span>
                    <span id="current-score-text" class="font-medium">Score: 0</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2.5 mt-2">
                    <div id="progress-bar" class="bg-sky-600 h-2.5 rounded-full" style="width: 10%"></div>
                </div>
            </header>

            <!-- Question Area -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <img id="question-image" src="https://placehold.co/600x300/e0f2fe/0c4a6e?text=Loading+Image..." alt="Question context" class="w-full h-48 md:h-64 object-cover rounded-lg mb-6">
                
                <p id="question-text" class="text-xl font-medium text-gray-900 mb-6">This is the question text?</p>
                
                <div id="answer-buttons" class="flex flex-col">
                    <!-- Answer buttons will be dynamically inserted here -->
                </div>

                <div id="feedback-area" class="mt-6">
                    <p id="feedback-text" class="text-lg font-medium"></p>
                </div>

                <button id="next-btn" class="w-full bg-sky-600 text-white font-bold py-3 px-6 rounded-lg mt-6 shadow-md transition-all duration-150 hover:bg-sky-700 disabled:bg-gray-400" style="display: none;">
                    Next Question
                </button>
            </div>
        </div>

        <!-- Summary Screen -->
        <div id="summary-screen" class="screen">
            <header class="text-center mb-8">
                <h1 class="text-4xl font-bold text-sky-800">Quiz Complete!</h1>
                <p class="text-lg text-gray-600 mt-2">Here's your performance breakdown.</p>
            </header>

            <div class="bg-white p-6 rounded-lg shadow-md mb-6">
                <h2 class="text-2xl font-bold mb-4">Overall Score</h2>
                <p id="final-score-text" class="text-4xl font-bold text-center text-sky-600 mb-4">8 / 10</p>
                <p id="final-percentage-text" class="text-xl text-center text-gray-500">(80%)</p>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-md mb-6">
                <h2 class="text-2xl font-bold mb-4">Breakdown by Grammar Point</h2>
                <div id="score-breakdown">
                    <!-- Score breakdown will be inserted here -->
                </div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-bold mb-4">Weak Areas & Practice Tips</h2>
                <div id="weak-areas-summary">
                    <!-- Weak areas summary will be inserted here -->
                </div>
            </div>

            <button id="restart-btn" class="w-full bg-sky-600 text-white font-bold py-3 px-6 rounded-lg mt-8 shadow-md transition-all duration-150 hover:bg-sky-700">
                Back to Home
            </button>
        </div>

    </div>

    <!-- JavaScript Logic -->
    <script defer>
        document.addEventListener('DOMContentLoaded', () => {

            // --- 1. STATE & DATA (C1 Level) ---
            
            const allQuestions = {
                pastModals: [
                    {
                        text: "The ground is soaking wet. It ___ (rain) heavily last night.",
                        options: [
                            { text: "must have rained", correct: true },
                            { text: "should have rained", correct: false },
                            { text: "could rain", correct: false },
                            { text: "had to rain", correct: false }
                        ],
                        tense: 'pastModals',
                        imageHint: 'Wet pavement'
                    },
                    {
                        text: "He walked right past me without saying hello. He ___ (see) me.",
                        options: [
                            { text: "mustn't have seen", correct: false },
                            { text: "shouldn't have seen", correct: false },
                            { text: "can't have seen", correct: true },
                            { text: "didn't see", correct: false }
                        ],
                        tense: 'pastModals',
                        imageHint: 'Person walking past'
                    },
                    {
                        text: "Her flight was cancelled. She ___ (be) very disappointed.",
                        options: [
                            { text: "must have been", correct: true },
                            { text: "might be", correct: false },
                            { text: "should be", correct: false },
                            { text: "had to be", correct: false }
                        ],
                        tense: 'pastModals',
                        imageHint: 'Airport cancellation board'
                    }
                ],
                mixedConditionals: [
                    {
                        text: "If I ___ (study) harder, I ___ (be) a lawyer now.",
                        options: [
                            { text: "had studied / would be", correct: true },
                            { text: "studied / would be", correct: false },
                            { text: "had studied / would have been", correct: false },
                            { text: "studied / would have been", correct: false }
                        ],
                        tense: 'mixedConditionals',
                        imageHint: 'Lawyer in a courtroom'
                    },
                    {
                        text: "If I ___ (not be) so afraid of heights, I ___ (try) bungee jumping last year.",
                        options: [
                            { text: "wasn't / would try", correct: false },
                            { text: "am not / would have tried", correct: false },
                            { text: "weren't / would have tried", correct: true },
                            { text: "hadn't been / would try", correct: false }
                        ],
                        tense: 'mixedConditionals',
                        imageHint: 'Bungee jumping'
                    },
                    {
                        text: "If he ___ (take) that job, he ___ (live) in New York right now.",
                        options: [
                            { text: "took / would be living", correct: false },
                            { text: "had taken / would be living", correct: true },
                            { text: "had taken / would have lived", correct: false },
                            { text: "took / would have lived", correct: false }
                        ],
                        tense: 'mixedConditionals',
                        imageHint: 'New York skyline'
                    }
                ],
                wishesAndRegrets: [
                    {
                        text: "I'm freezing. I wish I ___ (bring) my coat.",
                        options: [
                            { text: "brought", correct: false },
                            { text: "had brought", correct: true },
                            { text: "would bring", correct: false },
                            { text: "was bringing", correct: false }
                        ],
                        tense: 'wishesAndRegrets',
                        imageHint: 'Person shivering in cold'
                    },
                    {
                        text: "This car is too expensive. If only I ___ (have) more money.",
                        options: [
                            { text: "had", correct: true },
                            { text: "have", correct: false },
                            { text: "had had", correct: false },
                            { text: "would have", correct: false }
                        ],
                        tense: 'wishesAndRegrets',
                        imageHint: 'An expensive sports car'
                    },
                    {
                        text: "I wish my neighbours ___ (stop) playing loud music every night!",
                        options: [
                            { text: "stopped", correct: false },
                            { text: "had stopped", correct: false },
                            { text: "would stop", correct: true },
                            { text: "stop", correct: false }
                        ],
                        tense: 'wishesAndRegrets',
                        imageHint: 'Loud music from next door'
                    }
                ],
                inversion: [
                    {
                        text: "Hardly ___ (I / arrive) home when the doorbell rang.",
                        options: [
                            { text: "I had arrived", correct: false },
                            { text: "did I arrive", correct: false },
                            { text: "I arrived", correct: false },
                            { text: "had I arrived", correct: true }
                        ],
                        tense: 'inversion',
                        imageHint: 'A person at a front door'
                    },
                    {
                        text: "Not only ___ (he / be) late, but he also forgot the documents.",
                        options: [
                            { text: "he was", correct: false },
                            { text: "was he", correct: true },
                            { text: "he had been", correct: false },
                            { text: "had he been", correct: false }
                        ],
                        tense: 'inversion',
                        imageHint: 'Man running late'
                    },
                    {
                        text: "Never ___ (I / see) such a spectacular performance.",
                        options: [
                            { text: "have I seen", correct: true },
                            { text: "I have seen", correct: false },
                            { text: "I saw", correct: false },
                            { text: "did I see", correct: false }
                        ],
                        tense: 'inversion',
                        imageHint: 'Stage with performers'
                    }
                ],
                futurePerfectContinuous: [
                    {
                        text: "By 6 PM, I ___ (work) on this report for eight hours.",
                        options: [
                            { text: "will be working", correct: false },
                            { text: "will have worked", correct: false },
                            { text: "will have been working", correct: true },
                            { text: "am working", correct: false }
                        ],
                        tense: 'futurePerfectContinuous',
                        imageHint: 'Office clock at 6 PM'
                    },
                    {
                        text: "Next month, they ___ (live) in this house for ten years.",
                        options: [
                            { text: "will have been living", correct: true },
                            { text: "will live", correct: false },
                            { text: "will be living", correct: false },
                            { text: "will have lived", correct: false }
                        ],
                        tense: 'futurePerfectContinuous',
                        imageHint: 'A happy family in a house'
                    }
                ],
                futureInThePast: [
                    {
                        text: "I ___ (call) you earlier, but my phone battery died.",
                        options: [
                            { text: "was going to call", correct: true },
                            { text: "would call", correct: false },
                            { text: "called", correct: false },
                            { text: "had called", correct: false }
                        ],
                        tense: 'futureInThePast',
                        imageHint: 'Dead phone battery'
                    },
                    {
                        text: "He looked like he ___ (faint) just before we helped him.",
                        options: [
                            { text: "was fainting", correct: false },
                            { text: "fainted", correct: false },
                            { text: "was about to faint", correct: true },
                            { text: "would faint", correct: false }
                        ],
                        tense: 'futureInThePast',
                        imageHint: 'Person looking dizzy'
                    }
                ]
            };

            const quizModules = [
                {
                    id: 'past_modals',
                    title: 'Past Modals of Deduction',
                    description: "Practice *must have*, *can't have*, *might have*.",
                    questions: allQuestions.pastModals
                },
                {
                    id: 'mixed_conditionals',
                    title: 'Mixed Conditionals',
                    description: 'Combine past, present, and future in one sentence.',
                    questions: allQuestions.mixedConditionals
                },
                {
                    id: 'wishes_regrets',
                    title: 'Wishes & Regrets',
                    description: 'Practice *I wish...* and *If only...*',
                    questions: allQuestions.wishesAndRegrets
                },
                {
                    id: 'inversion',
                    title: 'Inversion for Emphasis',
                    description: 'Practice *Hardly had I...*, *Not only did he...*',
                    questions: allQuestions.inversion
                },
                {
                    id: 'advanced_future',
                    title: 'Advanced Future Forms',
                    description: 'Future Perfect Continuous vs. Future in the Past.',
                    questions: [
                        ...allQuestions.futurePerfectContinuous, 
                        ...allQuestions.futureInThePast
                    ].sort(() => 0.5 - Math.random())
                },
                {
                    id: 'all_c1',
                    title: 'C1 Structures Review',
                    description: 'A final mix of all C1 structures.',
                    questions: [
                        ...allQuestions.pastModals,
                        ...allQuestions.mixedConditionals,
                        ...allQuestions.wishesAndRegrets,
                        ...allQuestions.inversion,
                        ...allQuestions.futurePerfectContinuous,
                        ...allQuestions.futureInThePast
                    ].sort(() => 0.5 - Math.random()).slice(0, 10) // Get 10 random
                }
            ];
            
            const recommendations = {
                pastModals: "Review Past Modals for deduction. *Must have* (certainty), *might/could have* (possibility), *can't have* (impossibility).",
                mixedConditionals: "Review Mixed Conditionals. They mix timeframes, (e.g., 'If I *had studied* [past], I *would be* rich [present]'). Check which part is past and which is present.",
                wishesAndRegrets: "Review 'I wish / If only'. Use *Past Simple* for present wishes ('I wish I *were* rich') and *Past Perfect* for past regrets ('I wish I *had studied*'). Use *'would'* for annoyance.",
                inversion: "Review Inversion for emphasis (e.g., 'Hardly *had I arrived*...', 'Not only *did he go*...'). The auxiliary verb comes *before* the subject.",
                futurePerfectContinuous: "Use Future Perfect Continuous for the *duration* of an action that will be in progress *by* a future point (e.g., 'By 5 PM, I *will have been working* for 8 hours').",
                futureInThePast: "Use 'was/were going to' for plans from the past that didn't happen, or 'was/were about to' for an action that was imminent (very close to happening)."
            };

            // App's current state
            let currentQuizData = [];
            let currentQuestionIndex = 0;
            let currentScore = 0;
            let tenseScores = {}; // This variable name is kept, but it now tracks "grammar points"

            // --- 2. DOM ELEMENTS ---
            const screens = {
                home: document.getElementById('home-screen'),
                quiz: document.getElementById('quiz-screen'),
                summary: document.getElementById('summary-screen')
            };
            const homeQuizList = document.querySelector('#home-screen .grid');
            const quizTitle = document.getElementById('quiz-title');
            const progressText = document.getElementById('progress-text');
            const currentScoreText = document.getElementById('current-score-text');
            const progressBar = document.getElementById('progress-bar');
            const questionImage = document.getElementById('question-image');
            const questionText = document.getElementById('question-text');
            const answerButtonsContainer = document.getElementById('answer-buttons');
            const feedbackText = document.getElementById('feedback-text');
            const nextBtn = document.getElementById('next-btn');
            const finalScoreText = document.getElementById('final-score-text');
            const finalPercentageText = document.getElementById('final-percentage-text');
            const scoreBreakdownContainer = document.getElementById('score-breakdown');
            const weakAreasContainer = document.getElementById('weak-areas-summary');
            const restartBtn = document.getElementById('restart-btn');

            // --- 3. FUNCTIONS ---

            function showScreen(screenId) {
                Object.values(screens).forEach(screen => screen.classList.remove('active'));
                screens[screenId].classList.add('active');
            }

            function initializeHome() {
                homeQuizList.innerHTML = ''; // Clear existing
                quizModules.forEach(module => {
                    const button = document.createElement('button');
                    button.className = 'bg-white p-6 rounded-lg shadow-md text-left transition-all duration-150 hover:shadow-lg hover:scale-105';
                    button.innerHTML = `
                        <h3 class="text-xl font-bold text-sky-700">${module.title}</h3>
                        <p class="text-gray-600 mt-1">${module.description}</p>
                    `;
                    button.addEventListener('click', () => startQuiz(module.id));
                    homeQuizList.appendChild(button);
                });
            }

            function startQuiz(quizId) {
                const quiz = quizModules.find(m => m.id === quizId);
                // Ensure questions are shuffled for variety
                currentQuizData = [...quiz.questions].sort(() => 0.5 - Math.random());
                
                // Limit to 10 questions if the pool is larger
                if (currentQuizData.length > 10) {
                     currentQuizData = currentQuizData.slice(0, 10);
                }

                currentQuestionIndex = 0;
                currentScore = 0;
                
                tenseScores = {};
                currentQuizData.forEach(q => {
                    // 'tense' key is used for the grammar point
                    if (!tenseScores[q.tense]) {
                        tenseScores[q.tense] = { correct: 0, total: 0 };
                    }
                });

                quizTitle.textContent = quiz.title;
                showQuestion();
                showScreen('quiz');
            }

            function showQuestion() {
                feedbackText.textContent = '';
                feedbackText.className = 'text-lg font-medium';
                nextBtn.style.display = 'none';
                answerButtonsContainer.innerHTML = '';

                const question = currentQuizData[currentQuestionIndex];
                const totalQuestions = currentQuizData.length;

                questionText.textContent = question.text;
                const imageUrl = `https://placehold.co/600x300/e0f2fe/0c4a6e?text=${encodeURIComponent(question.imageHint)}`;
                questionImage.src = imageUrl;
                questionImage.alt = question.imageHint;
                
                progressText.textContent = `Question ${currentQuestionIndex + 1} / ${totalQuestions}`;
                currentScoreText.textContent = `Score: ${currentScore}`;
                const progressPercentage = ((currentQuestionIndex + 1) / totalQuestions) * 100;
                progressBar.style.width = `${progressPercentage}%`;
                
                // Shuffle options for more challenge
                const shuffledOptions = [...question.options].sort(() => 0.5 - Math.random());

                shuffledOptions.forEach(option => {
                    const button = document.createElement('button');
                    button.textContent = option.text;
                    button.className = 'answer-btn';
                    button.dataset.correct = option.correct;
                    button.dataset.tense = question.tense; // 'tense' key stores the grammar point
                    button.addEventListener('click', selectAnswer);
                    answerButtonsContainer.appendChild(button);
                });
            }

            function selectAnswer(e) {
                const selectedButton = e.target;
                const isCorrect = selectedButton.dataset.correct === 'true';
                const tense = selectedButton.dataset.tense; // 'tense' key stores the grammar point

                if (!tenseScores[tense]) {
                     tenseScores[tense] = { correct: 0, total: 0 };
                }

                tenseScores[tense].total++;
                if (isCorrect) {
                    currentScore++;
                    tenseScores[tense].correct++;
                    feedbackText.textContent = "Correct!";
                    feedbackText.classList.add('text-green-600');
                    selectedButton.classList.add('correct');
                } else {
                    feedbackText.textContent = "Not quite.";
                    feedbackText.classList.add('text-red-600');
                    selectedButton.classList.add('wrong');
                }
                
                currentScoreText.textContent = `Score: ${currentScore}`;

                Array.from(answerButtonsContainer.children).forEach(button => {
                    if (button.dataset.correct === 'true' && !isCorrect) {
                        button.classList.add('correct');
                    }
                    button.disabled = true;
                });

                nextBtn.style.display = 'block';
            }

            function handleNextButton() {
                currentQuestionIndex++;
                if (currentQuestionIndex < currentQuizData.length) {
                    showQuestion();
                } else {
                    showSummary();
                }
            }

            function showSummary() {
                const totalQuestions = currentQuizData.length;
                const percentage = totalQuestions > 0 ? Math.round((currentScore / totalQuestions) * 100) : 0;

                finalScoreText.textContent = `${currentScore} / ${totalQuestions}`;
                finalPercentageText.textContent = `(${percentage}%)`;

                scoreBreakdownContainer.innerHTML = '';
                weakAreasContainer.innerHTML = '';
                
                let hasWeakAreas = false;

                for (const tense in tenseScores) { // 'tense' variable now holds grammar point keys
                    const score = tenseScores[tense];
                    if (score.total > 0) {
                        const tensePercentage = Math.round((score.correct / score.total) * 100);
                        // 'mixedConditionals' -> 'Mixed Conditionals'
                        const tenseName = tense.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase()); 

                        const breakdownEl = document.createElement('div');
                        breakdownEl.className = 'flex justify-between items-center mb-2 py-2 border-b';
                        breakdownEl.innerHTML = `
                            <span class="font-medium">${tenseName}</span>
                            <span class="text-gray-600">${score.correct} / ${score.total} (${tensePercentage}%)</span>
                        `;
                        scoreBreakdownContainer.appendChild(breakdownEl);

                        // Weak area defined as < 75%
                        if (tensePercentage < 75) {
                            hasWeakAreas = true;
                            const weakAreaEl = document.createElement('div');
                            weakAreaEl.className = 'mb-4';
                            weakAreaEl.innerHTML = `
                                <h4 class="font-bold text-lg text-red-700">${tenseName}</h4>
                                <p class="text-gray-700">${recommendations[tense] || 'Practice this structure more.'}</p>
                            `;
                            weakAreasContainer.appendChild(weakAreaEl);
                        }
                    }
                }

                if (!hasWeakAreas) {
                    weakAreasContainer.innerHTML = '<p class="text-green-700 font-medium">Excellent work! No significant weak areas detected.</p>';
                }

                showScreen('summary');
            }

            function restartApp() {
                showScreen('home');
            }

            // --- 4. EVENT LISTENERS ---
            nextBtn.addEventListener('click', handleNextButton);
            restartBtn.addEventListener('click', restartApp);

            // --- 5. INITIALIZE ---
            initializeHome();
            showScreen('home');
        });
    </script>

</body>
</html>
